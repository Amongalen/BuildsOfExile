{% extends "base.html" %}
{% load static %}
{% block content %}
  <div class="row bg-secondary rounded-3 mb-2 mx-0 p-2">
    <div class="col-9">
      <h3><strong>{{ build_guide.title }}</strong></h3>
      <h3>
        {% if build_guide.pob_details.ascendancy_name %}
          {{ build_guide.pob_details.ascendancy_name }}
        {% else %}
          {{ build_guide.pob_details.class_name }}
        {% endif %}
      </h3>
      Primary active skills: {{ build_guide.pob_details.main_active_skills|join:', ' }}

    </div>
    <div class="col row text-end">
      {% with build_guide.author as user_profile %}
        <div class="col"><h4 class="mb-0"><a
          href="{% url 'user_profile' user_profile.user_id user_profile.user.username %}">
          {{ user_profile.user.username }}</a></h4>
          {% if user_profile.youtube_url %}
            <a href="{{ user_profile.youtube_url }}">YouTube.com</a><br/>
          {% endif %}

          {% if user_profile.twitch_url %}
            <a href="{{ user_profile.twitch_url }}">Twitch.tv</a>
          {% endif %}
        </div>
        <div class="col-auto "><img id="avatar_preview" alt="Avatar" width="80" height="80"
                                    src="{% if user_profile.avatar %}
                                          {{ user_profile.avatar.url }}
                                        {% else %}
                                          {% static 'icons/avatar_placeholder.svg' %}
                                        {% endif %}"
                                    class="user-avatar"/></div>
      {% endwith %}
      <div style="font-size: small">
        Created: {{ build_guide.creation_datetime|date:'Y-m-d H:i' }}
        {% if build_guide.creation_datetime != build_guide.modification_datetime %}
          </br>Last modified: {{ build_guide.modification_datetime|date:'Y-m-d H:i' }}
        {% endif %}
      </div>
    </div>
  </div>
  {% if user == build_guide.author.user %}
    <button class="mb-2 btn btn-outline-light btn-secondary"
            onclick="location.href='{% url 'edit_guide' pk %}'">
      Edit
    </button>
  {% endif %}
  <nav>
    <div class="nav nav-tabs " id="nav-tab" role="tablist">
      <button class="nav-link active" id="nav-guide-tab" data-bs-toggle="tab" data-bs-target="#nav-guide"
              type="button" role="tab" aria-controls="nav-guide" aria-selected="true">Guide
      </button>
      <button class="nav-link" id="nav-skill-tree-tab" data-bs-toggle="tab" data-bs-target="#nav-skill-tree"
              type="button" role="tab" aria-controls="nav-skill-tree" aria-selected="false">Skill tree
      </button>
      <button class="nav-link" id="nav-gear-and-gems-tab" data-bs-toggle="tab" data-bs-target="#nav-gear-and-gems"
              type="button" role="tab" aria-controls="nav-gear-and-gems" aria-selected="false">Gear and gems
      </button>
      <button class="nav-link" id="nav-discuss-tab" data-bs-toggle="tab" data-bs-target="#nav-discuss"
              type="button" role="tab" aria-controls="nav-discuss" aria-selected="false">Discuss
      </button>
    </div>
  </nav>
  <div class="tab-content" id="nav-tabContent">
    <div class="tab-pane fade show active" id="nav-guide" role="tabpanel"
         aria-labelledby="nav-guide-tab"></div>
    <div class="tab-pane fade" id="nav-skill-tree" role="tabpanel"
         aria-labelledby="nav-skill-tree-tab"></div>
    <div class="tab-pane fade" id="nav-gear-and-gems" role="tabpanel"
         aria-labelledby="nav-gear-and-gems-tab">
    </div>
    <div class="tab-pane fade" id="nav-discuss" role="tabpanel"
         aria-labelledby="nav-discuss-tab">{% include 'discuss_tab.html' %}
    </div>
  </div>

  <script>
    $(document).ready(function () {
      loadGuideTab();
    });

    function loadGuideTab() {
      $.get(
        "{% url 'guide_tab' pk %}",
        function (data) {
          $("#nav-guide").html(data);
          loadGearGemsTab();
          loadSkillTreeTab();
        });
    }

    function loadSkillTreeTab() {
      $.get(
        "{% url 'skill_tree_tab' pk %}",
        function (data) {
          $("#nav-skill-tree").html(data);
        });
    }

    function loadGearGemsTab() {
      $.get(
        "{% url 'gear_gems_tab' pk %}",
        function (data) {
          $("#nav-gear-and-gems").html(data);
        });
    }
  </script>

{% endblock %}
